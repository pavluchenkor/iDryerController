# Прошивка

Универсальное решение для сушки филамента. Можно собрать из чего-то доступного и дешевого, например старого нагревателя от хитблока, ненужного кулера и радиатора, а в качестве корпуса использовать коробку из хоз.мага и любой утеплитель. Список используемых деталей ограничен только фантазией.

Что умеет:
- сушить на выбранной температуре заданное время;
- регулировать мощность нагревателя и достаточно точно поддерживать необходимую температуру;
- отображать температуру воздуха, нагревательного элемента, влажность; 
- по окончании сушки переходить в режим хранения и хранить с небольшим нагревом бесконечно долго;
- хранить с выбранной температурой;
  - при достижении заданной влажности очень умно экономит электроэнергию, включает/выключает сушку по параметру дельта(указывается дельта влажности для выкл и вкл);
- имеет пресеты под часто используемые пластики;
- автоматическая настройка пид на борту.

Что будет уметь:
- взвешивать катушку и писать остаток пластика на экране;
- генерировать высокий сигнал на пине для соединения с входом датчика филамента платы принтера.

Особенности железа:
- управление почти любым нагревательным элементом 24/220В;
- управление вентилятором обдува камеры по ШИМ;
- версия для работы с напряжением 24В(можно и 12В);
- версия для работы с напряжением 220В;
Дизайн платы размещены на [jlcpcb.com](https://oshwlab.com/svet_team/idryer)


Особенности прошивок:
- файл прошивки содержит все возможные варианты, настройка прошивки редактируется в файле configuration.h
- прошивка для бутлоадера ардуино / штука не самая безопасная несмотря на кучу проверок и защит
  - нет WDT
  - нет поддержки серво
  - нет поддержки дополнительного ШИМ канала
  - не будет весов для катушек в сушилке
- прошивка под ядро MiniCore
  - работает watch dog timer / в случае cбоя перезагрузит прошивку
  - [поддержка двух серв](https://t.me/iDryer/361)(используются для регулярного проветривания камеры)
  - поддержка дополнительного канала шим
  - расширенное меню и функции
  - безопасность прошивки
Прошивку для ядра ардуино использовать можно, но не рекомендуется,лучше купить программатор, перешить бутлоадер и пользоваться безопасной прошивкой.

Коммутация:

Соедините ардуино Нано с программатором или ArduinoISP 

https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/pins.png
![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/pins.png)

![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/usbasp10.jpg)

Обратите внимание, что цоколевка разъемов может отличаться

![img](https://raw.githubusercontent.com/pavluchenkor/iDryerController/master/src_isp/img001.png)

Компиляция и прошивка:

> В файле configuration.h сконфигурируйте прошивку.
> в файле platformio.ini указать USB порт к которому подключена ардуина

1. Прошивка ардуино
pio run -e nanoatmega328new -t upload -t monitor

1. Прошивка ядра MiniCore
Потребуется программатор USBasp(можно купить в магазине) или  usbisp(можно сделать из другой ардуино, тоже работает, но программатор лучше).

2.1 смена фьюзов и бутлоадера

2.1.1 pio run -e fuses_bootloader -t fuses

2.1.2 pio run -e fuses_bootloader -t bootloader

2.2 прошивка МК<br>
    pio run -e ISP -t upload -t monitor

2.3 прошивка EEPROM<br>
    pio run -e EEP -t uploadeep -t monitor

> Если после прошивки и в процессе эксплуатации на экране появятся ошибки, обратитесь к файлу configuration.h

или за помощью в группу

[группа в телеграмм :fontawesome-solid-paper-plane:](https://t.me/iDryer){ .md-button }
